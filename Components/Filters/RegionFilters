import React, { useState } from 'react';
import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from "@/components/ui/select";
import { Input } from "@/components/ui/input";
import { Filter, MapPin, Search } from "lucide-react";

export default function RegionFilters({ 
  settlements, 
  selectedRegion, 
  setSelectedRegion, 
  selectedSubRegion, 
  setSelectedSubRegion,
  searchTerm,
  setSearchTerm
}) {
  const regions = [...new Set(settlements.map(s => s.region))].filter(Boolean);
  const subRegions = selectedRegion && selectedRegion !== 'הכל' 
    ? [...new Set(settlements.filter(s => s.region === selectedRegion).map(s => s.sub_region))].filter(Boolean)
    : [...new Set(settlements.map(s => s.sub_region))].filter(Boolean);

  // סינון יישובים לפי כל הקריטריונים
  const filteredSettlements = settlements.filter(s => {
    const regionMatch = !selectedRegion || selectedRegion === 'הכל' || s.region === selectedRegion;
    const subRegionMatch = !selectedSubRegion || selectedSubRegion === 'הכל' || s.sub_region === selectedSubRegion;
    const searchMatch = !searchTerm || s.name?.toLowerCase().includes(searchTerm.toLowerCase());
    return regionMatch && subRegionMatch && searchMatch;
  });

  return (
    <div className="flex flex-col gap-4 p-4 bg-white/80 backdrop-blur rounded-2xl shadow-lg border border-blue-100">
      <div className="flex items-center gap-2 text-blue-700">
        <Filter className="w-5 h-5" />
        <span className="font-semibold">סינון יישובים:</span>
      </div>
      
      <div className="flex flex-col lg:flex-row gap-3">
        <div className="flex flex-col md:flex-row gap-3 flex-1">
          <div className="relative flex-1">
            <Search className="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4" />
            <Input
              placeholder="חיפוש לפי שם יישוב..."
              value={searchTerm || ''}
              onChange={(e) => setSearchTerm && setSearchTerm(e.target.value)}
              className="pr-10 bg-white border-blue-200 hover:border-blue-300 transition-colors"
            />
          </div>
          
          <Select value={selectedRegion} onValueChange={setSelectedRegion}>
            <SelectTrigger className="w-full md:w-48 bg-white border-blue-200 hover:border-blue-300 transition-colors">
              <SelectValue placeholder="בחר אזור" />
            </SelectTrigger>
            <SelectContent>
              <SelectItem value="הכל">כל האזורים</SelectItem>
              {regions.map((region) => (
                <SelectItem key={region} value={region}>
                  <div className="flex items-center gap-2">
                    <MapPin className="w-4 h-4" />
                    {region}
                  </div>
                </SelectItem>
              ))}
            </SelectContent>
          </Select>

          <Select value={selectedSubRegion} onValueChange={setSelectedSubRegion}>
            <SelectTrigger className="w-full md:w-48 bg-white border-blue-200 hover:border-blue-300 transition-colors">
              <SelectValue placeholder="בחר תת-אזור" />
            </SelectTrigger>
            <SelectContent>
              <SelectItem value="הכל">כל התת-אזורים</SelectItem>
              {subRegions.map((subRegion) => (
                <SelectItem key={subRegion} value={subRegion}>
                  {subRegion}
                </SelectItem>
              ))}
            </SelectContent>
          </Select>
        </div>

        <div className="text-sm text-gray-600 flex items-center gap-2">
          <span className="bg-blue-100 text-blue-700 px-3 py-1 rounded-full font-medium">
            {filteredSettlements.length} יישובים
          </span>
        </div>
      </div>
    </div>
  );
}